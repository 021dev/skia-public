bool test() {
    bool expr = sqrt(1) > 0;

    int ok = 0, bad = 0;

    // Test boolean short-circuiting with constants on the left side.
    if (true  && expr) { ++ok; } else { ++bad; } // -> (expr)
    if (false && expr) { ++bad; } else { ++ok; } // -> (false) -> block removed
    if (true  ^^ expr) { ++bad; } else { ++ok; } // -> unchanged
    if (false ^^ expr) { ++ok; } else { ++bad; } // -> (expr)
    if (true  || expr) { ++ok; } else { ++bad; } // -> (true)
    if (false || expr) { ++ok; } else { ++bad; } // -> (expr)
    if (true  == expr) { ++ok; } else { ++bad; } // -> (expr)
    if (false == expr) { ++bad; } else { ++ok; } // -> unchanged
    if (true  != expr) { ++bad; } else { ++ok; } // -> unchanged
    if (false != expr) { ++ok; } else { ++bad; } // -> (expr)

    // Test boolean short-circuiting with constants on the right side.
    if (expr && true ) { ++ok; } else { ++bad; } // -> (expr)
    if (expr && false) { ++bad; } else { ++ok; } // -> (false) -> block removed
    if (expr ^^ true ) { ++bad; } else { ++ok; } // -> unchanged
    if (expr ^^ false) { ++ok; } else { ++bad; } // -> (expr)
    if (expr || true ) { ++ok; } else { ++bad; } // -> (true)
    if (expr || false) { ++ok; } else { ++bad; } // -> (expr)
    if (expr == true ) { ++ok; } else { ++bad; } // -> (expr)
    if (expr == false) { ++bad; } else { ++ok; } // -> unchanged
    if (expr != true ) { ++bad; } else { ++ok; } // -> unchanged
    if (expr != false) { ++ok; } else { ++bad; } // -> (expr)

    return ok == 20 && bad == 0;
}

half4 main() {
    return test() ? half4(0,1,0,1) : half4(1,0,0,1);
}
